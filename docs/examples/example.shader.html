<!DOCTYPE html><html><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>example.shader</title><meta property="og:title" content="example.shader" /><meta property="og:type" content="website" /><meta name="description" content="shaders can be quite tricky but are very powerful once you learn to use them." /><meta property="og:description" content="shaders can be quite tricky but are very powerful once you learn to use them." /><meta property="og:image" content="https://c3d.madefor.cc/pack.png" /><meta property="og:site_name" content="C3D Docs" /><link rel="stylesheet" href="../main.css?v=07f8166c" type="text/css" /><meta name="theme-color" content="#c8d87c"></head><body><nav id="nav"><button id="nav-reveal" type="button">&#9776;</button><h1><a href=".././"><img src="../pack.png" alt="C3D Docs" /></a></h1><div class="nav-links"><h2 class="collapsed" tabindex="0">Modules</h2><ul><li><a href="../modules/c3d.camera.html" class="sidebar-link">c3d.camera</a></li><li><a href="../modules/c3d.event.html" class="sidebar-link">c3d.event</a></li><li><a href="../modules/c3d.geometry.html" class="sidebar-link">c3d.geometry</a></li><li><a href="../modules/c3d.graphics.html" class="sidebar-link">c3d.graphics</a></li><li><a href="../modules/c3d.keyboard.html" class="sidebar-link">c3d.keyboard</a></li><li><a href="../modules/c3d.mouse.html" class="sidebar-link">c3d.mouse</a></li><li><a href="../modules/c3d.perspective.html" class="sidebar-link">c3d.perspective</a></li><li><a href="../modules/c3d.pipe.html" class="sidebar-link">c3d.pipe</a></li><li><a href="../modules/c3d.scene.html" class="sidebar-link">c3d.scene</a></li><li><a href="../modules/c3d.shader.html" class="sidebar-link">c3d.shader</a></li><li><a href="../modules/c3d.sys.html" class="sidebar-link">c3d.sys</a></li><li><a href="../modules/c3d.thread.html" class="sidebar-link">c3d.thread</a></li><li><a href="../modules/c3d.timer.html" class="sidebar-link">c3d.timer</a></li></ul><h2 class="collapsed" tabindex="0">Callbacks</h2><ul><li><a href="../callbacks/c3d.errorhandler.html" class="sidebar-link">c3d.errorhandler</a></li><li><a href="../callbacks/c3d.load.html" class="sidebar-link">c3d.load</a></li><li><a href="../callbacks/c3d.postrender.html" class="sidebar-link">c3d.postrender</a></li><li><a href="../callbacks/c3d.quit.html" class="sidebar-link">c3d.quit</a></li><li><a href="../callbacks/c3d.render.html" class="sidebar-link">c3d.render</a></li><li><a href="../callbacks/c3d.run.html" class="sidebar-link">c3d.run</a></li><li><a href="../callbacks/c3d.threaderror.html" class="sidebar-link">c3d.threaderror</a></li><li><a href="../callbacks/c3d.update.html" class="sidebar-link">c3d.update</a></li></ul><h2 class="collapsed" tabindex="0">Event-Callbacks</h2><ul><li><a href="../event-callbacks/c3d.keypressed.html" class="sidebar-link">c3d.keypressed</a></li><li><a href="../event-callbacks/c3d.keyreleased.html" class="sidebar-link">c3d.keyreleased</a></li><li><a href="../event-callbacks/c3d.mousemoved.html" class="sidebar-link">c3d.mousemoved</a></li><li><a href="../event-callbacks/c3d.mousepressed.html" class="sidebar-link">c3d.mousepressed</a></li><li><a href="../event-callbacks/c3d.mousereleased.html" class="sidebar-link">c3d.mousereleased</a></li><li><a href="../event-callbacks/c3d.textinput.html" class="sidebar-link">c3d.textinput</a></li><li><a href="../event-callbacks/c3d.wheelmoved.html" class="sidebar-link">c3d.wheelmoved</a></li></ul><h2 class="collapsed" tabindex="0">Object</h2><ul><li><a href="../objects/camera_object.html" class="sidebar-link">camera_object</a></li><li><a href="../objects/generic_shape.html" class="sidebar-link">generic_shape</a></li><li><a href="../objects/imported_model.html" class="sidebar-link">imported_model</a></li><li><a href="../objects/palette.html" class="sidebar-link">palette</a></li><li><a href="../objects/scene_object.html" class="sidebar-link">scene_object</a></li><li><a href="../objects/texture.html" class="sidebar-link">texture</a></li></ul><h2 tabindex="0">Examples</h2><ul><li><strong class="sidebar-link selected">example.shader</strong></li><li><a href="example.texturing.html" class="sidebar-link">example.texturing</a></li><li><a href="example.thread.html" class="sidebar-link">example.thread</a></li></ul><h2 class="collapsed" tabindex="0">Misc</h2><ul><li><a href="../misc/geometry_flags.html" class="sidebar-link">geometry_flags</a></li><li><a href="../misc/geometry_table_format.html" class="sidebar-link">geometry_table_format</a></li><li><a href="../misc/texture_load_settings.html" class="sidebar-link">texture_load_settings</a></li></ul></div></nav><div id="main"><div id="search-form" role="form"><input id="search-box" type="text" placeholder="Search..." autocomplete="off" tabindex="0"></input><div id="search-results"></div></div><section id="content"><h1>example.shader</h1><h2>shaders can be quite tricky but are very powerful once you learn to use them.</h2>
<h2>all of these will assume you have this as your base code</h2>
<pre class="highlight" data-lua-kind="stmt"><span class="keyword">local</span> <span class="ident">cube</span> <span class="symbol">=</span> <span class="ident">c3d</span><span class="symbol">.</span><span class="symbol">geometry</span><span class="symbol">.</span><span class="symbol">cube_simple</span><span class="symbol">(</span><span class="symbol">)</span><span class="symbol">:</span><span class="symbol">push</span><span class="symbol">(</span><span class="symbol">)</span><span class="symbol">:</span><span class="symbol">reposition</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">)</span>

<span class="keyword">function</span> <span class="ident">c3d</span><span class="symbol">.</span><span class="symbol">update</span><span class="symbol">(</span><span class="symbol">)</span>
    <span class="ident">cube</span><span class="symbol">:</span><span class="symbol">set_rotation</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="ident">os</span><span class="symbol">.</span><span class="symbol">epoch</span><span class="symbol">(</span><span class="string">"utc"</span><span class="symbol">)</span><span class="symbol">/</span><span class="number">20</span><span class="symbol">)</span>
<span class="keyword">end</span>
<span class="symbol"></span></pre><h1>vertex</h1>
<h2>wave effect</h2>
<pre class="highlight" data-lua-kind="expr"><span class="ident">cube</span><span class="symbol">:</span><span class="symbol">set_vertex_shader</span><span class="symbol">(</span><span class="keyword">function</span><span class="symbol">(</span><span class="ident">vertex</span><span class="symbol">,</span><span class="symbol">...</span><span class="symbol">)</span>
    <span class="keyword">local</span> <span class="ident">t</span> <span class="symbol">=</span> <span class="ident">os</span><span class="symbol">.</span><span class="symbol">epoch</span><span class="symbol">(</span><span class="string">"utc"</span><span class="symbol">)</span>

    <span class="ident">vertex</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span> <span class="symbol">=</span> <span class="ident">vertex</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span> <span class="symbol">+</span> <span class="ident">math</span><span class="symbol">.</span><span class="symbol">sin</span><span class="symbol">(</span><span class="ident">vertex</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="symbol">*</span><span class="number">10</span><span class="symbol">+</span><span class="ident">t</span><span class="symbol">/</span><span class="number">200</span><span class="symbol">)</span><span class="symbol">/</span><span class="number">5</span> <span class="comment">-- adds the wave effect to the height of the vertex offset by the x of it and time</span>

    <span class="keyword">return</span> <span class="ident">c3d</span><span class="symbol">.</span><span class="symbol">shader</span><span class="symbol">.</span><span class="symbol">default</span><span class="symbol">.</span><span class="symbol">vertex</span><span class="symbol">(</span><span class="ident">vertex</span><span class="symbol">,</span><span class="symbol">...</span><span class="symbol">)</span> <span class="comment">-- applies the default transforms to the modified vertex</span>
<span class="keyword">end</span><span class="symbol">)</span>
<span class="symbol"></span></pre><h1>geometry</h1>
<h2>triangles colored by their index</h2>
<pre class="highlight" data-lua-kind="expr"><span class="ident">cube</span><span class="symbol">:</span><span class="symbol">set_geometry_shader</span><span class="symbol">(</span><span class="keyword">function</span><span class="symbol">(</span><span class="ident">triangle</span><span class="symbol">,</span><span class="ident">index</span><span class="symbol">)</span>
    <span class="keyword">function</span> <span class="ident">triangle</span><span class="symbol">.</span><span class="symbol">fs</span><span class="symbol">(</span><span class="symbol">)</span> <span class="comment">-- modifies the triangles fragment shader to return the color of the triangle dependent on the index</span>
        <span class="keyword">return</span> <span class="number">2</span><span class="symbol">^</span><span class="symbol">(</span><span class="ident">index</span><span class="symbol">%</span><span class="number">15</span><span class="symbol">)</span>
    <span class="keyword">end</span>

    <span class="keyword">return</span> <span class="ident">triangle</span> <span class="comment">-- returns modified triangle</span>
<span class="keyword">end</span><span class="symbol">)</span>
<span class="symbol"></span></pre><h1>fragment</h1>
<h2>random noise fragment shader</h2>
<pre class="highlight" data-lua-kind="expr"><span class="ident">cube</span><span class="symbol">:</span><span class="symbol">set_frag_shader</span><span class="symbol">(</span><span class="keyword">function</span><span class="symbol">(</span><span class="ident">pixel_data</span><span class="symbol">)</span>
    <span class="keyword">return</span> <span class="number">2</span><span class="symbol">^</span><span class="symbol">(</span><span class="ident">math</span><span class="symbol">.</span><span class="symbol">random</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">)</span><span class="symbol">*</span><span class="number">15</span><span class="symbol">)</span>
<span class="keyword">end</span><span class="symbol">)</span>
<span class="symbol"></span></pre><h2>CC color gradient made using a fragment and vertex shader</h2>
<pre class="highlight" data-lua-kind="stmt"><span class="keyword">local</span> <span class="ident">random_color_lookup</span> <span class="symbol">=</span> <span class="ident">setmetatable</span><span class="symbol">(</span><span class="symbol">{</span><span class="symbol">}</span><span class="symbol">,</span><span class="symbol">{</span><span class="ident">__index</span><span class="symbol">=</span><span class="keyword">function</span><span class="symbol">(</span><span class="ident">this</span><span class="symbol">,</span><span class="ident">index</span><span class="symbol">)</span>
    <span class="keyword">local</span> <span class="ident">c</span> <span class="symbol">=</span> <span class="ident">math</span><span class="symbol">.</span><span class="symbol">random</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="number">15</span><span class="symbol">)</span>
    <span class="ident">rawset</span><span class="symbol">(</span><span class="ident">this</span><span class="symbol">,</span><span class="ident">index</span><span class="symbol">,</span><span class="ident">c</span><span class="symbol">)</span>
    <span class="keyword">return</span> <span class="ident">c</span>
<span class="keyword">end</span><span class="symbol">}</span><span class="symbol">)</span> <span class="comment">-- a special table which has "infinite" amount of random colors on its indices</span>

<span class="ident">cube</span><span class="symbol">:</span><span class="symbol">set_vertex_shader</span><span class="symbol">(</span><span class="keyword">function</span><span class="symbol">(</span><span class="ident">vertex</span><span class="symbol">,</span><span class="symbol">...</span><span class="symbol">)</span>
    <span class="keyword">local</span> <span class="ident">transformed_vertex</span> <span class="symbol">=</span> <span class="ident">c3d</span><span class="symbol">.</span><span class="symbol">shader</span><span class="symbol">.</span><span class="symbol">default</span><span class="symbol">.</span><span class="symbol">vertex</span><span class="symbol">(</span><span class="ident">vertex</span><span class="symbol">,</span><span class="symbol">...</span><span class="symbol">)</span>

    <span class="ident">transformed_vertex</span><span class="symbol">.</span><span class="symbol">frag</span> <span class="symbol">=</span> <span class="symbol">{</span><span class="ident">epic_color</span><span class="symbol">=</span><span class="ident">random_color_lookup</span><span class="symbol">[</span><span class="ident">vertex</span><span class="symbol">.</span><span class="symbol">index</span><span class="symbol">]</span><span class="symbol">}</span> <span class="comment">-- adds the color to be interpolated between the vertices</span>

    <span class="keyword">return</span> <span class="ident">transformed_vertex</span>
<span class="keyword">end</span><span class="symbol">)</span>

<span class="ident">cube</span><span class="symbol">:</span><span class="symbol">set_frag_shader</span><span class="symbol">(</span><span class="keyword">function</span><span class="symbol">(</span><span class="ident">pixel_data</span><span class="symbol">)</span>
    <span class="keyword">return</span> <span class="number">2</span><span class="symbol">^</span><span class="ident">math</span><span class="symbol">.</span><span class="symbol">ceil</span><span class="symbol">(</span><span class="ident">math</span><span class="symbol">.</span><span class="symbol">min</span><span class="symbol">(</span><span class="ident">math</span><span class="symbol">.</span><span class="symbol">max</span><span class="symbol">(</span><span class="ident">pixel_data</span><span class="symbol">.</span><span class="symbol">epic_color</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">)</span><span class="symbol">,</span><span class="number">15</span><span class="symbol">)</span><span class="symbol">)</span> <span class="comment">-- gets the interpolated fragment passed from the vertex shader and clamps it</span>
<span class="keyword">end</span><span class="symbol">)</span>
<span class="symbol"></span></pre></section><footer>Last updated on 2022-10-24</footer></div><div id="search-overlay"></div><script src="../main.js?v=c0ed00b8" type="text/javascript" defer=""></script></body></html>